{% extends "base.html" %}

{% block title %}Run Negotiation - NegMAS App{% endblock %}

{% block content %}
<div class="card">
    <div class="card-header">
        <h1 class="card-title">Run Negotiation</h1>
    </div>
    <div class="card-body">
        <form id="negotiation-form" hx-post="/negotiation/run" hx-target="#result-container" hx-swap="innerHTML">
            
            {% include "partials/form_basic.html" %}
            {% include "partials/form_deadline.html" %}
            {% include "partials/form_scenario.html" %}
            {% include "partials/form_generated.html" %}
            {% include "partials/form_output.html" %}
            {% include "partials/form_plotting.html" %}
            {% include "partials/form_saving.html" %}
            {% include "partials/form_advanced.html" %}

            <!-- Submit Button -->
            <div style="margin-top: 1.5rem; display: flex; gap: 1rem;">
                <button type="submit" class="btn btn-primary btn-lg">
                    <span class="btn-text">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polygon points="5 3 19 12 5 21 5 3"/>
                        </svg>
                        Run Negotiation
                    </span>
                    <span class="btn-loading">
                        <div class="spinner"></div>
                        Running...
                    </span>
                </button>
                <button type="reset" class="btn btn-secondary btn-lg">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/>
                        <path d="M3 3v5h5"/>
                    </svg>
                    Reset
                </button>
            </div>
        </form>
    </div>
</div>

<!-- Results Container -->
<div id="result-container"></div>
{% endblock %}

{% block scripts %}
<script>
    // Handle checkbox values for HTMX (unchecked checkboxes aren't sent)
    document.getElementById('negotiation-form').addEventListener('htmx:configRequest', function(evt) {
        const form = evt.target;
        const checkboxes = form.querySelectorAll('input[type="checkbox"]');
        checkboxes.forEach(cb => {
            if (!cb.checked) {
                evt.detail.parameters[cb.name] = 'false';
            } else {
                evt.detail.parameters[cb.name] = 'true';
            }
        });
    });
</script>
{% endblock %}
