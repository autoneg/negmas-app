<!-- Tournament Grid Panel - Competition matrix with summary and per-scenario tabs -->
<div class="tournament-grid-pane" :class="{ collapsed: tournamentPanelCollapsed.grid }">
    <div class="tournament-panel-header" @click="tournamentPanelCollapsed.grid = !tournamentPanelCollapsed.grid">
        <h3>
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="14" height="14" 
                 :style="{ transform: tournamentPanelCollapsed.grid ? 'rotate(-90deg)' : 'rotate(0deg)', transition: 'transform 0.2s' }">
                <polyline points="6 9 12 15 18 9"></polyline>
            </svg>
            Competition Grid
        </h3>
    </div>
    
    <div class="tournament-panel-content" x-show="!tournamentPanelCollapsed.grid" x-collapse>
        <!-- Tabs: Summary + Scenarios -->
        <div class="tournament-scenario-tabs">
            <button class="tournament-scenario-tab" 
                    :class="{ active: tournamentGrid.currentTab === 'summary' }"
                    @click="tournamentGrid.currentTab = 'summary'">Summary</button>
            <template x-for="(scenario, idx) in tournamentGrid.scenarios" :key="idx">
                <button class="tournament-scenario-tab" 
                        :class="{ active: tournamentGrid.currentTab === idx }"
                        @click="tournamentGrid.currentTab = idx"
                        x-text="scenario"></button>
            </template>
        </div>
        
        <div class="tournament-grid-wrapper">
            <!-- Empty state when grid not initialized -->
            <div class="tournament-grid-empty" x-show="tournamentGrid.competitors.length === 0">
                <div class="spinner"></div>
                <p x-text="tournamentSetupProgress?.message || 'Initializing tournament...'"></p>
                <template x-if="tournamentSetupProgress">
                    <div class="setup-progress-bar" style="width: 200px; height: 4px; background: var(--color-bg-tertiary); border-radius: 2px; margin-top: 8px;">
                        <div style="height: 100%; background: var(--color-primary); border-radius: 2px; transition: width 0.3s ease;" 
                             :style="'width: ' + (tournamentSetupProgress.current / tournamentSetupProgress.total * 100) + '%'"></div>
                    </div>
                </template>
            </div>
            
            <!-- Summary Grid (aggregated across all scenarios) -->
            <template x-if="tournamentGrid.competitors.length > 0 && tournamentGrid.currentTab === 'summary'">
                <div class="tournament-grid"
                     :style="'grid-template-columns: auto repeat(' + tournamentGrid.opponents.length + ', 1fr)'">
                    <!-- Header Row -->
                    <div class="tournament-grid-header-cell"></div>
                    <template x-for="(opponent, j) in tournamentGrid.opponents" :key="'sh-'+j">
                        <div class="tournament-grid-header-cell" :title="opponent" x-text="opponent.slice(0, 12)"></div>
                    </template>
                    
                    <!-- Data Rows -->
                    <template x-for="(competitor, i) in tournamentGrid.competitors" :key="'sr-'+i">
                        <div class="tournament-grid-row" style="display: contents;">
                            <div class="tournament-grid-row-header" :title="competitor" x-text="competitor.slice(0, 12)"></div>
                            <template x-for="(opponent, j) in tournamentGrid.opponents" :key="'sc-'+i+'-'+j">
                                <div class="tournament-cell summary-cell" 
                                     :class="{ 'self-play': i === j && !newTournament.self_play }"
                                     :style="getSummaryCellStyle(i, j)">
                                    <span class="summary-percent" x-text="getSummaryCellPercent(i, j)"></span>
                                </div>
                            </template>
                        </div>
                    </template>
                </div>
            </template>
            
            <!-- Scenario-specific Grid -->
            <template x-if="tournamentGrid.competitors.length > 0 && tournamentGrid.currentTab !== 'summary'">
                <div class="tournament-grid"
                     :style="'grid-template-columns: auto repeat(' + tournamentGrid.opponents.length + ', 1fr)'">
                    <!-- Header Row -->
                    <div class="tournament-grid-header-cell"></div>
                    <template x-for="(opponent, j) in tournamentGrid.opponents" :key="'h-'+j">
                        <div class="tournament-grid-header-cell" :title="opponent" x-text="opponent.slice(0, 12)"></div>
                    </template>
                    
                    <!-- Data Rows -->
                    <template x-for="(competitor, i) in tournamentGrid.competitors" :key="'r-'+i">
                        <div class="tournament-grid-row" style="display: contents;">
                            <div class="tournament-grid-row-header" :title="competitor" x-text="competitor.slice(0, 12)"></div>
                            <template x-for="(opponent, j) in tournamentGrid.opponents" :key="'c-'+i+'-'+j">
                                <div class="tournament-cell" :class="getScenarioCellClass(i, j)" :title="getScenarioCellTooltip(i, j)">
                                    <!-- Icon based on state -->
                                    <template x-if="getScenarioCellStatus(i, j) === 'running'">
                                        <div class="spinner spinner-xs"></div>
                                    </template>
                                    <template x-if="getScenarioCellStatus(i, j) === 'agreement' || getScenarioCellStatus(i, j) === 'complete'">
                                        <svg class="tournament-cell-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <polyline points="20 6 9 17 4 12"></polyline>
                                        </svg>
                                    </template>
                                    <template x-if="getScenarioCellStatus(i, j) === 'timeout'">
                                        <svg class="tournament-cell-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <circle cx="12" cy="12" r="10"></circle>
                                            <polyline points="12 6 12 12 16 14"></polyline>
                                        </svg>
                                    </template>
                                    <template x-if="getScenarioCellStatus(i, j) === 'error' || getScenarioCellStatus(i, j) === 'broken'">
                                        <svg class="tournament-cell-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <circle cx="12" cy="12" r="10"></circle>
                                            <line x1="15" y1="9" x2="9" y2="15"></line>
                                            <line x1="9" y1="9" x2="15" y2="15"></line>
                                        </svg>
                                    </template>
                                    <!-- Progress indicator for multiple runs -->
                                    <template x-if="getScenarioCellProgress(i, j).total > 1">
                                        <div style="position: absolute; bottom: 2px; left: 2px; right: 2px; font-size: 8px; opacity: 0.7;"
                                             x-text="getScenarioCellProgress(i, j).completed + '/' + getScenarioCellProgress(i, j).total"></div>
                                    </template>
                                </div>
                            </template>
                        </div>
                    </template>
                </div>
            </template>
        </div>
    </div>
</div>
