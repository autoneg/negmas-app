<!-- Tournament Score Analysis Panel - Detailed score breakdown with filtering -->
<div class="tournament-detail-panel" :class="{ collapsed: tournamentPanelCollapsed.scoreAnalysis }">
    <div class="tournament-panel-header" @click="tournamentPanelCollapsed.scoreAnalysis = !tournamentPanelCollapsed.scoreAnalysis">
        <h3>
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="14" height="14" 
                 :style="{ transform: tournamentPanelCollapsed.scoreAnalysis ? 'rotate(-90deg)' : 'rotate(0deg)', transition: 'transform 0.2s' }">
                <polyline points="6 9 12 15 18 9"></polyline>
            </svg>
            Score Analysis
            <template x-if="scoreAnalysis.loading">
                <span class="loading loading-spinner loading-xs ml-2"></span>
            </template>
        </h3>
    </div>
    <div class="tournament-panel-content" x-show="!tournamentPanelCollapsed.scoreAnalysis" x-collapse>
        <!-- Controls Row -->
        <div class="score-analysis-controls" style="display: flex; gap: 8px; flex-wrap: wrap; padding: 8px; background: var(--color-bg-secondary); border-bottom: 1px solid var(--color-border);">
            <div class="form-group form-group-inline" style="margin: 0;">
                <label class="form-label" style="font-size: 11px; margin-right: 4px;">Metric:</label>
                <select class="form-control form-control-sm" style="font-size: 11px; min-width: 120px;"
                        x-model="scoreAnalysis.metric"
                        @change="loadScoreAnalysis()">
                    <template x-for="m in (scoreAnalysis.data?.available_metrics || ['utility', 'advantage', 'welfare', 'nash_optimality', 'kalai_optimality', 'ks_optimality', 'max_welfare_optimality', 'pareto_optimality'])" :key="m">
                        <option :value="m" x-text="m.replace(/_/g, ' ')"></option>
                    </template>
                </select>
            </div>
            <div class="form-group form-group-inline" style="margin: 0;">
                <label class="form-label" style="font-size: 11px; margin-right: 4px;">Stat:</label>
                <select class="form-control form-control-sm" style="font-size: 11px; min-width: 90px;"
                        x-model="scoreAnalysis.statistic"
                        @change="loadScoreAnalysis()">
                    <template x-for="s in (scoreAnalysis.data?.available_statistics || ['mean', 'median', 'min', 'max', 'std', 'truncated_mean', 'count', 'sum'])" :key="s">
                        <option :value="s" x-text="s.replace(/_/g, ' ')"></option>
                    </template>
                </select>
            </div>
            <div class="form-group form-group-inline" style="margin: 0;">
                <label class="form-label" style="font-size: 11px; margin-right: 4px;">Scenario:</label>
                <select class="form-control form-control-sm" style="font-size: 11px; min-width: 100px;"
                        x-model="scoreAnalysis.scenario"
                        @change="loadScoreAnalysis()">
                    <option value="">All</option>
                    <template x-for="sc in (scoreAnalysis.data?.scenarios || [])" :key="sc">
                        <option :value="sc" x-text="sc"></option>
                    </template>
                </select>
            </div>
            <div class="form-group form-group-inline" style="margin: 0;">
                <label class="form-label" style="font-size: 11px; margin-right: 4px;">Partner:</label>
                <select class="form-control form-control-sm" style="font-size: 11px; min-width: 100px;"
                        x-model="scoreAnalysis.partner"
                        @change="loadScoreAnalysis()">
                    <option value="">All</option>
                    <template x-for="p in (scoreAnalysis.data?.partners || [])" :key="p">
                        <option :value="p" x-text="p"></option>
                    </template>
                </select>
            </div>
        </div>
        
        <!-- Leaderboard Table -->
        <div class="score-analysis-leaderboard" style="max-height: 300px; overflow-y: auto;">
            <template x-if="scoreAnalysis.data?.leaderboard?.length > 0">
                <table class="tournament-table" style="font-size: 11px;">
                    <thead>
                        <tr>
                            <th style="width: 30px;">#</th>
                            <th>Strategy</th>
                            <th style="text-align: right;">Score</th>
                            <th style="text-align: right;">Count</th>
                            <th style="text-align: right;">Min</th>
                            <th style="text-align: right;">Max</th>
                            <th style="text-align: right;">Mean</th>
                            <th style="text-align: right;">Std</th>
                        </tr>
                    </thead>
                    <tbody>
                        <template x-for="entry in scoreAnalysis.data.leaderboard" :key="entry.strategy">
                            <tr :class="{ 'rank-1': entry.rank === 1, 'rank-2': entry.rank === 2, 'rank-3': entry.rank === 3 }">
                                <td style="font-weight: bold;" x-text="entry.rank"></td>
                                <td style="font-weight: 500;" x-text="entry.strategy"></td>
                                <td style="text-align: right; font-weight: bold; color: var(--color-primary);" x-text="entry.score?.toFixed(4) || '-'"></td>
                                <td style="text-align: right; color: var(--color-text-secondary);" x-text="entry.count || '-'"></td>
                                <td style="text-align: right; color: var(--color-text-secondary);" x-text="entry.min?.toFixed(3) || '-'"></td>
                                <td style="text-align: right; color: var(--color-text-secondary);" x-text="entry.max?.toFixed(3) || '-'"></td>
                                <td style="text-align: right; color: var(--color-text-secondary);" x-text="entry.mean?.toFixed(3) || '-'"></td>
                                <td style="text-align: right; color: var(--color-text-secondary);" x-text="entry.std?.toFixed(3) || '-'"></td>
                            </tr>
                        </template>
                    </tbody>
                </table>
            </template>
            <template x-if="!scoreAnalysis.data?.leaderboard?.length && !scoreAnalysis.loading">
                <div class="empty-state" style="padding: 16px; text-align: center; color: var(--color-text-secondary);">
                    No score data available
                </div>
            </template>
            <template x-if="scoreAnalysis.loading">
                <div class="empty-state" style="padding: 16px; text-align: center;">
                    <div class="spinner"></div>
                    <p style="margin-top: 8px; color: var(--color-text-secondary);">Loading score analysis...</p>
                </div>
            </template>
        </div>
    </div>
</div>
