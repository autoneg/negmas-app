<!-- Negotiations List View - Table of running/completed/saved negotiations -->
<div class="negotiations-table-view" x-show="!currentNegotiation" x-init="initNegotiationsTables()">
    <!-- Header with actions -->
    <div class="table-header">
        <div style="display: flex; align-items: center; gap: 12px;">
            <h2>Negotiations <span class="text-muted" style="font-weight: normal; font-size: 14px;" x-text="'(' + (runningNegotiations.length + completedNegotiations.length + savedNegotiations.length) + ')'"></span></h2>
        </div>
        <div style="display: flex; gap: 8px; align-items: center;">
            <button class="btn btn-secondary btn-sm" @click="loadSavedNegotiations()" :disabled="savedNegotiationsLoading">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="14" height="14">
                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                    <polyline points="17 8 12 3 7 8"/>
                    <line x1="12" y1="3" x2="12" y2="15"/>
                </svg>
                <span x-text="savedNegotiationsLoading ? 'Loading...' : 'Load Saved'"></span>
            </button>
            <button class="btn btn-primary" @click="openNewNegotiation()">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="16" height="16">
                    <line x1="12" y1="5" x2="12" y2="19"></line>
                    <line x1="5" y1="12" x2="19" y2="12"></line>
                </svg>
                <span>Start Negotiation</span>
            </button>
        </div>
    </div>
    
    <!-- Running Negotiations Section -->
    <div class="table-section" x-show="runningNegotiations.length > 0" style="margin-bottom: 24px;">
        <h3>
            <span class="status-dot running"></span>
            Running (<span x-text="runningNegotiations.length"></span>)
        </h3>
        <div id="running-negotiations-table"></div>
    </div>
    
    <!-- Completed Negotiations Section (current session) -->
    <div class="table-section" style="flex: 1; display: flex; flex-direction: column; min-height: 0;">
        <h3>
            <span class="status-dot" style="background: var(--success);"></span>
            Completed This Session (<span x-text="completedNegotiations.length"></span>)
        </h3>
        
        <template x-if="completedNegotiations.length === 0 && runningNegotiations.length === 0 && savedNegotiations.length === 0">
            <div class="empty-state" style="flex: 1;">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                    <path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"/>
                </svg>
                <div class="empty-state-title">No Negotiations Yet</div>
                <div class="empty-state-text">
                    Start a new negotiation or load saved ones.
                </div>
            </div>
        </template>
        
        <div id="completed-negotiations-table" x-show="completedNegotiations.length > 0"></div>
    </div>
    
    <!-- Saved Negotiations Section -->
    <div class="table-section saved-negotiations-section" x-show="savedNegotiations.length > 0 || showArchivedNegotiations || tagFilter" style="flex: 1; display: flex; flex-direction: column; min-height: 0;">
        <h3 style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 8px;">
            <span style="display: flex; align-items: center; gap: 8px;">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="16" height="16">
                    <path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"/>
                </svg>
                Saved (<span x-text="savedNegotiations.length"></span>)
            </span>
            <div style="display: flex; gap: 8px; align-items: center;">
                <!-- Tag filter -->
                <select class="form-control form-control-sm" style="width: auto; min-width: 100px;" x-model="tagFilter" @change="loadSavedNegotiations()">
                    <option value="">All tags</option>
                    <template x-for="tag in availableTags" :key="tag">
                        <option :value="tag" x-text="tag"></option>
                    </template>
                </select>
                <!-- Show archived toggle -->
                <label style="display: flex; align-items: center; gap: 4px; font-size: 12px; font-weight: normal; cursor: pointer;">
                    <input type="checkbox" x-model="showArchivedNegotiations" @change="loadSavedNegotiations()">
                    <span>Show archived</span>
                </label>
                <!-- Clear all button -->
                <button class="btn btn-ghost btn-xs" @click="clearSavedNegotiations()" title="Clear all saved">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="14" height="14">
                        <polyline points="3 6 5 6 21 6"></polyline>
                        <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                    </svg>
                </button>
            </div>
        </h3>
        <div id="saved-negotiations-table"></div>
    </div>
    
    <!-- Tag Editor Modal -->
    <div class="modal-overlay" :class="{ active: tagEditorNegotiation }" @click.self="closeTagEditor()">
        <div class="modal" style="max-width: 400px;" x-show="tagEditorNegotiation">
            <div class="modal-header">
                <h2 class="modal-title">Edit Tags</h2>
                <button class="btn btn-ghost btn-sm" @click="closeTagEditor()">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="16" height="16">
                        <line x1="18" y1="6" x2="6" y2="18"></line>
                        <line x1="6" y1="6" x2="18" y2="18"></line>
                    </svg>
                </button>
            </div>
            <div class="modal-content" style="padding: 16px;">
                <div class="text-muted" style="font-size: 12px; margin-bottom: 8px;">
                    Negotiation: <code x-text="tagEditorNegotiation?.id"></code>
                </div>
                
                <!-- Current tags -->
                <div style="margin-bottom: 16px;">
                    <div style="display: flex; flex-wrap: wrap; gap: 4px; min-height: 32px; padding: 8px; background: var(--bg-secondary); border-radius: 4px;">
                        <template x-for="tag in tagEditorTags" :key="tag">
                            <span class="badge badge-primary" style="display: flex; align-items: center; gap: 4px;">
                                <span x-text="tag"></span>
                                <button @click="removeTagFromEditor(tag)" style="background: none; border: none; padding: 0; cursor: pointer; color: inherit; opacity: 0.7;">&times;</button>
                            </span>
                        </template>
                        <template x-if="tagEditorTags.length === 0">
                            <span class="text-muted">No tags</span>
                        </template>
                    </div>
                </div>
                
                <!-- Add new tag -->
                <div style="display: flex; gap: 8px; margin-bottom: 16px;">
                    <input type="text" class="form-control" placeholder="Add new tag..." 
                           x-model="newTagInput" 
                           @keydown.enter.prevent="addNewTag()"
                           style="flex: 1;">
                    <button class="btn btn-secondary btn-sm" @click="addNewTag()" :disabled="!newTagInput.trim()">Add</button>
                </div>
                
                <!-- Existing tags suggestions -->
                <div x-show="availableTags.length > 0" style="margin-bottom: 16px;">
                    <div class="text-muted" style="font-size: 11px; margin-bottom: 4px;">Quick add:</div>
                    <div style="display: flex; flex-wrap: wrap; gap: 4px;">
                        <template x-for="tag in availableTags.filter(t => !tagEditorTags.includes(t)).slice(0, 10)" :key="tag">
                            <button class="badge badge-neutral" style="cursor: pointer; border: none;" @click="tagEditorTags.push(tag)" x-text="tag"></button>
                        </template>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" @click="closeTagEditor()">Cancel</button>
                <button class="btn btn-primary" @click="saveTagsFromEditor()">Save Tags</button>
            </div>
        </div>
    </div>
</div>
