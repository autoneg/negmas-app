<!-- Tournaments List View - Table of running/completed/saved tournaments -->
<div class="tournaments-table-view" x-show="!selectedTournament" x-init="initTournamentsTables()">
    <!-- Header with actions -->
    <div class="table-header">
        <div style="display: flex; align-items: center; gap: 12px;">
            <h2>Tournaments <span class="text-muted" style="font-weight: normal; font-size: 14px;" x-text="'(' + (runningTournaments.length + completedTournaments.length + savedTournaments.length) + ')'"></span></h2>
        </div>
        <div style="display: flex; gap: 8px; align-items: center;">
            <button class="btn btn-secondary btn-sm" @click="loadSavedTournaments()" :disabled="savedTournamentsLoading">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="14" height="14">
                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                    <polyline points="17 8 12 3 7 8"/>
                    <line x1="12" y1="3" x2="12" y2="15"/>
                </svg>
                <span x-text="savedTournamentsLoading ? 'Loading...' : 'Load Saved'"></span>
            </button>
            <button class="btn btn-primary" @click="showNewTournament = true; loadAllScenarios(); loadNegotiatorTypes()">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="16" height="16">
                    <line x1="12" y1="5" x2="12" y2="19"></line>
                    <line x1="5" y1="12" x2="19" y2="12"></line>
                </svg>
                <span>Start Tournament</span>
            </button>
        </div>
    </div>
    
    <!-- Running Tournaments Section -->
    <div class="table-section" x-show="runningTournaments.length > 0" style="margin-bottom: 24px;">
        <h3>
            <span class="status-dot running"></span>
            Running (<span x-text="runningTournaments.length"></span>)
        </h3>
        <div id="running-tournaments-table"></div>
    </div>
    
    <!-- Completed Tournaments Section (current session) -->
    <div class="table-section" style="flex: 1; display: flex; flex-direction: column; min-height: 0;">
        <h3>
            <span class="status-dot" style="background: var(--success);"></span>
            Completed This Session (<span x-text="completedTournaments.length"></span>)
        </h3>
        
        <template x-if="completedTournaments.length === 0 && runningTournaments.length === 0 && savedTournaments.length === 0">
            <div class="empty-state" style="flex: 1;">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                    <circle cx="12" cy="8" r="5"></circle>
                    <path d="M12 13v7"></path>
                    <path d="M9 20h6"></path>
                </svg>
                <div class="empty-state-title">No Tournaments Yet</div>
                <div class="empty-state-text">
                    Start a new tournament or load saved ones.
                </div>
            </div>
        </template>
        
        <div id="completed-tournaments-table" x-show="completedTournaments.length > 0"></div>
    </div>
    
    <!-- Saved Tournaments Section -->
    <div class="table-section saved-tournaments-section" x-show="savedTournaments.length > 0 || showArchivedTournaments || tournamentTagFilter" style="flex: 1; display: flex; flex-direction: column; min-height: 0;">
        <h3 style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 8px;">
            <span style="display: flex; align-items: center; gap: 8px;">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="16" height="16">
                    <path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"/>
                </svg>
                Saved (<span x-text="savedTournaments.length"></span>)
                <!-- Selection indicator -->
                <template x-if="selectedTournamentIds.length > 0">
                    <span class="badge badge-primary badge-sm" x-text="selectedTournamentIds.length + ' selected'"></span>
                </template>
            </span>
            <div style="display: flex; gap: 8px; align-items: center;">
                <!-- Combine Selected button (appears when tournaments selected) -->
                <template x-if="selectedTournamentIds.length >= 2">
                    <button class="btn btn-primary btn-sm" @click="openCombineModal('selected')">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="14" height="14">
                            <path d="M8 3H5a2 2 0 0 0-2 2v3m18 0V5a2 2 0 0 0-2-2h-3m0 18h3a2 2 0 0 0 2-2v-3M3 16v3a2 2 0 0 0 2 2h3"/>
                        </svg>
                        <span>Combine Selected</span>
                    </button>
                </template>
                <!-- Combine from Paths button -->
                <button class="btn btn-secondary btn-sm" @click="openCombineModal('paths')" title="Combine tournaments from filesystem paths">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="14" height="14">
                        <path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"/>
                        <line x1="12" y1="11" x2="12" y2="17"/>
                        <line x1="9" y1="14" x2="15" y2="14"/>
                    </svg>
                    <span>Combine Paths</span>
                </button>
                <!-- Tag filter -->
                <select class="form-control form-control-sm" style="width: auto; min-width: 100px;" x-model="tournamentTagFilter" @change="loadSavedTournaments()">
                    <option value="">All tags</option>
                    <template x-for="tag in availableTournamentTags" :key="tag">
                        <option :value="tag" x-text="tag"></option>
                    </template>
                </select>
                <!-- Show archived toggle -->
                <label style="display: flex; align-items: center; gap: 4px; font-size: 12px; font-weight: normal; cursor: pointer;">
                    <input type="checkbox" x-model="showArchivedTournaments" @change="loadSavedTournaments()">
                    <span>Show archived</span>
                </label>
                <!-- Clear all button -->
                <button class="btn btn-ghost btn-xs" @click="clearSavedTournaments()" title="Clear all saved">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="14" height="14">
                        <polyline points="3 6 5 6 21 6"></polyline>
                        <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                    </svg>
                </button>
            </div>
        </h3>
        <div id="saved-tournaments-table" x-show="savedTournaments.length > 0"></div>
    </div>
</div>

<!-- Combine Tournaments Modal -->
<div class="modal-overlay" x-show="showCombineModal" x-cloak @click.self="closeCombineModal()" style="z-index: 1100;">
    <div class="modal-content" style="width: 600px; max-width: 90vw;">
        <div class="modal-header">
            <h3 x-text="combineMode === 'selected' ? 'Combine Selected Tournaments' : 'Combine Tournaments from Paths'"></h3>
            <button class="modal-close" @click="closeCombineModal()">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="20" height="20">
                    <line x1="18" y1="6" x2="6" y2="18"></line>
                    <line x1="6" y1="6" x2="18" y2="18"></line>
                </svg>
            </button>
        </div>
        <div class="modal-body" style="max-height: 60vh; overflow-y: auto;">
            <!-- Mode tabs -->
            <div style="display: flex; gap: 8px; margin-bottom: 16px;">
                <button class="btn btn-sm" :class="combineMode === 'selected' ? 'btn-primary' : 'btn-secondary'" @click="combineMode = 'selected'">
                    From Selected
                </button>
                <button class="btn btn-sm" :class="combineMode === 'paths' ? 'btn-primary' : 'btn-secondary'" @click="combineMode = 'paths'">
                    From Paths
                </button>
            </div>
            
            <!-- Selected Mode -->
            <div x-show="combineMode === 'selected'">
                <div class="form-group">
                    <label class="form-label">Selected Tournaments (<span x-text="selectedTournamentIds.length"></span>)</label>
                    <div style="background: var(--bg-secondary); padding: 8px 12px; border-radius: 4px; max-height: 150px; overflow-y: auto;">
                        <template x-for="id in selectedTournamentIds" :key="id">
                            <div style="display: flex; justify-content: space-between; align-items: center; padding: 4px 0; border-bottom: 1px solid var(--border-color);">
                                <code style="font-size: 12px;" x-text="id"></code>
                                <button class="btn btn-ghost btn-xs" @click="toggleTournamentSelection(id)">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="12" height="12">
                                        <line x1="18" y1="6" x2="6" y2="18"></line>
                                        <line x1="6" y1="6" x2="18" y2="18"></line>
                                    </svg>
                                </button>
                            </div>
                        </template>
                        <template x-if="selectedTournamentIds.length === 0">
                            <div class="text-muted" style="font-size: 12px;">No tournaments selected. Select tournaments from the table.</div>
                        </template>
                    </div>
                </div>
            </div>
            
            <!-- Paths Mode -->
            <div x-show="combineMode === 'paths'">
                <div class="form-group">
                    <label class="form-label">Paths to Search (one per line)</label>
                    <textarea class="form-control" x-model="combinePaths" rows="4" placeholder="/path/to/tournaments/folder&#10;/another/path" style="font-family: monospace; font-size: 12px;"></textarea>
                    <div class="form-help">Enter filesystem paths containing tournament directories. Use recursively to find all tournaments within.</div>
                </div>
                <div class="form-group">
                    <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                        <input type="checkbox" x-model="combineRecursive">
                        <span>Search recursively</span>
                    </label>
                </div>
                <button class="btn btn-secondary btn-sm" @click="previewCombinePaths()" :disabled="combineLoading || !combinePaths.trim()">
                    <span x-text="combineLoading ? 'Searching...' : 'Preview'"></span>
                </button>
                
                <!-- Preview results -->
                <template x-if="combinePreview">
                    <div style="margin-top: 12px; background: var(--bg-secondary); padding: 12px; border-radius: 4px;">
                        <div style="font-weight: 600; margin-bottom: 8px;">
                            Found <span x-text="combinePreview.count"></span> tournaments
                        </div>
                        <div style="max-height: 150px; overflow-y: auto;">
                            <template x-for="t in combinePreview.tournaments" :key="t.path">
                                <div style="display: flex; justify-content: space-between; padding: 4px 0; border-bottom: 1px solid var(--border-color); font-size: 12px;">
                                    <span x-text="t.name || t.id"></span>
                                    <span class="text-muted" x-text="t.n_negotiations + ' negotiations'"></span>
                                </div>
                            </template>
                        </div>
                    </div>
                </template>
            </div>
            
            <!-- Output name (common to both modes) -->
            <div class="form-group" style="margin-top: 16px;">
                <label class="form-label">Output Name (optional)</label>
                <input type="text" class="form-control" x-model="combineOutputName" placeholder="combined_tournament">
                <div class="form-help">Leave empty for auto-generated name with timestamp.</div>
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn btn-secondary" @click="closeCombineModal()">Cancel</button>
            <button class="btn btn-primary" @click="combineTournaments()" 
                    :disabled="combineLoading || (combineMode === 'selected' && selectedTournamentIds.length < 2) || (combineMode === 'paths' && !combinePaths.trim())">
                <span x-text="combineLoading ? 'Combining...' : 'Combine'"></span>
            </button>
        </div>
    </div>
</div>
